---
title: "IA - projeto"
author: "Arthur Vinícius Tomé Rodrigues, João Victor Barroso Mafra, Jobson Lucas Dias da Silva"
date: "23 de fevereiro de 2018"
output: html_document
---

```{r setup, include=FALSE, echo=FALSE}
require(ggplot2, quietly = TRUE)
require(dplyr, quietly = TRUE)
require(bnlearn, quietly = TRUE)
require(tidyr)
require(reshape2, quietly = TRUE)
library(knitr, quietly = TRUE)
library(reshape2, quietly = TRUE)

```


## Procedimento para ler os dados
```{r, echo=FALSE}
ler_dados = function(arquivo){
  
  require("dplyr", warn.conflicts = FALSE)
  
  file = read.csv(arquivo, stringsAsFactors = TRUE, encoding='UTF-8')
  return (file)
}
```


## Salvar dados dos alunos de cc que tenham nota(exceto os que trancaram).
```{r, echo=FALSE}
##Isso aqui só executa se tiver os dados brutos
alunos_ufcg = ler_dados("alunosUFCG.CSV")

alunos_cc = alunos_ufcg %>% 
  filter(Cod_Curso == 14102100 & Situacao != "Trancado") %>% 
  select(Matricula, Cod_Disciplina, Cod_Evasao, Nome_Disciplina, Media_Disciplina, Situacao)

write.csv(alunos_cc, file = "dados_alunos_cc.csv", row.names=FALSE, fileEncoding = "UTF-8")
```


## Selecionar dados dos alunos de CC dos três primeiros períodos
```{r, echo=FALSE}

#disciplinas até o terceiro período ministradas por professores do DSC
disciplinas_escolhidas = c(1411167, 1411180, 1411174, 1411168, 1411181, 1411170, 1411172, 1411179, 1411171, 1109113, 1411176)

df_alunos_cc = ler_dados("dados_alunos_cc.CSV") %>% 
  filter(Cod_Disciplina %in% disciplinas_escolhidas)
```


## Salvar dados dos alunos de CC com as notas no formato necessário para o modelo Caxalau
```{r, echo=FALSE}
df_cc_notas_simplificadas = df_alunos_cc

#transformar notas em int
df_cc_notas_simplificadas$Media_Arredon = lapply(df_cc_notas_simplificadas$Media_Disciplina, 
                                                 function(x) round(x, digits = 0))

df_cc_notas_simplificadas$Media_Int = lapply(df_cc_notas_simplificadas$Media_Disciplina, 
                                                 function(x) round(x*10, digits = 0))

#transformar para df -> tentar ordenar colunas criadas resulta em erro, pois contém lists e não vectors
df_cc_notas_simplificadas = as.data.frame(lapply(df_cc_notas_simplificadas, unlist))

#retirar espaços dos nomes das disciplinas
df_cc_notas_simplificadas = df_cc_notas_simplificadas %>% 
  mutate(Nome_Disciplina = as.factor(gsub(" ", ".", Nome_Disciplina)))

```


## Transformar em coluna as disciplinas (facilita manipular média e usá-la como evidência na rede bayesiana)
```{r}

xx = df_cc_notas_simplificadas

#transformar cada disciplina (código dela) em uma coluna
xx = xx %>% dcast(Matricula + Media_Int + Cod_Disciplina + Media_Arredon + Cod_Evasao + Nome_Disciplina + Situacao ~ Cod_Disciplina, value.var = "Media_Disciplina") %>% group_by(Matricula)

disciplins = as.character(disciplinas_escolhidas)

# preencher a coluna com a média inteira da disciplina
xx[disciplins] = lapply(xx[disciplins], 
                        function(x){ 
                            media = xx$Media_Int
                            ifelse(x >= 1, 
                                   media,
                                   x)
                            
                        })

names(xx) = c("Matricula", "Media_Int", "Cod_Disciplina", "Media_Arredon", "Cod_Evasao", "Nome_Disciplina", "Situacao", "Discreta", "P1", "P2", "Grafos", "TC", "Eda", "IC", "GI", "Leda", "LP1", "LP2")

write.csv(xx, file = "alunos_notas_simplif.csv", row.names=FALSE, fileEncoding = "UTF-8")

```
