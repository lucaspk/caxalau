---
title: "IA - projeto"
author: "Arthur Vinícius Tomé Rodrigues, João Victor Barroso Mafra, Jobson Lucas Dias da Silva"
date: "23 de fevereiro de 2018"
output: html_document
---

```{r setup, include=FALSE, echo=FALSE}
require(ggplot2, quietly = TRUE)
require(dplyr, quietly = TRUE)
require(bnlearn, quietly = TRUE)
library(knitr, quietly = TRUE)
```


## Procedimento para ler os dados
```{r, echo=FALSE}
ler_dados = function(arquivo){
  
  require("dplyr", warn.conflicts = FALSE)
  
  file = read.csv(arquivo, stringsAsFactors = TRUE, encoding='UTF-8')
  return (file)
}
```


## Script para salvar em um csv os alunos de cc que tenham nota(exceto os que trancaram).
```{r, echo=FALSE}
##Isso aqui só executa se tiver os dados brutos
alunos_ufcg = ler_dados("alunosUFCG.CSV")

alunos_cc = alunos_ufcg %>% 
  filter(Cod_Curso == 14102100 & Situacao != "Trancado") %>% 
  select(Matricula, Cod_Disciplina, Cod_Evasao, Nome_Disciplina, Media_Disciplina, Situacao)

write.csv(alunos_cc, file = "dados_alunos_cc.csv", row.names=FALSE, fileEncoding = "UTF-8")
```


## Ler arquivo com dados alunos de cc
```{r, echo=FALSE}
df_alunos_cc = ler_dados("dados_alunos_cc.CSV")
```


## Criar variáveis necessárias para modelo do Caxalau
```{r, echo=FALSE}
df_cc_notas_simplificadas = df_alunos_cc

#transformar notas em int
df_cc_notas_simplificadas$Media_Arredon = lapply(df_cc_notas_simplificadas$Media_Disciplina, 
                                                 function(x) round(x, digits = 0))

df_cc_notas_simplificadas$Media_Int = lapply(df_cc_notas_simplificadas$Media_Disciplina, 
                                                 function(x) x*10)

#transformar para df, pois tentar ordenar colunas criadas resulta em erro -> contém lists e não vectors
df_cc_notas_simplificadas = as.data.frame(lapply(df_cc_notas_simplificadas, unlist))

```


## Transformar em fatores -> usar rede bayesiana
```{r}
##dados para o modelo gerado pelo R 
col_names = colnames(df_alunos_cc)
df_alunos_cc[, col_names] = lapply(df_alunos_cc[, col_names], factor)

##dados para o modelo usado pelo Caxalau
col_names_simp = colnames(df_cc_notas_simplificadas)
df_cc_notas_simplificadas[, col_names_simp] = lapply(df_cc_notas_simplificadas[, col_names_simp], factor)
```


# ======= A partir daqui


## Gerar BN para nosso modelo do caxalau
```{r}
res_ <- hc(df_cc_notas_simplificadas)
plot(res_)

fitted_bn <- bn.fit(res_, data = df_cc_notas_simplificadas)

# Calcula a bn para as disciplinas passadas da lista(no caso, as disciplinas que pretende cursar). Isso facilita nossa vida.
# Assim está igual ao site do analytics.

disciplinas = c("1411167", "1109103")

cpquery(fitted_bn, event = (Situacao=="Aprovado"), evidence = (Cod_Disciplina %in% disciplinas))

```


## Testando para mais de uma disciplina

```{r}
cpquery(fitted_bn, event = (Situacao=="Aprovado"), evidence = (Cod_Disciplina == "1411167" | Cod_Disciplina == "1109103"))
```



## Gerar BN para modelo simples
```{r}
##rede bayesiana gerada
res <- hc(df_alunos_cc)
#res$arcs <- res$arcs[-which((res$arcs[,'from'] == "fator_origem" & res$arcs[,'to'] == "fator_destino")),]
plot(res)

fittedbn <- bn.fit(res, data = df_alunos_cc, method="mle")

#print(fittedbn)

cpquery(fittedbn, event = (Situacao=="Aprovado"), evidence = (Media_Disciplina == "8.3"))
```

## Separação dados em treino(60%) e teste(40%)
```{r}

```


## Validar BN gerada pelo R
```{r}

```


## Validar nosso modelo para BN do Caxalau
```{r}

```


## Comparação entre modelos(dados de teste)
```{r}

```

